# 项目五——优惠券全套业务与样式污染

项目五是一个`react`项目；我并没有系统学习过`react`，但恰巧开始学习`Taro+React`写小程序，因此也是有了更好的学习机会。

因为最近要学的，要做的都非常多，所以我并不能很详细地进行记录，不过我遇到了一个典型问题，让我非常希望记录下来：也就是标题上的**样式污染**

之所以那么想记录，一是我的记性不好，如果不及时写下来我可能会忘记；二是我很久之前就有看到过相关的问题，但从来没遇到过，甚至不明白为什么有这种情况，今天终于遇到了，并且顺利解决了这个问题：

**样式污染**是指在一个组件或页面中，由于 CSS 样式的全局性，导致某些样式影响到其他组件或页面的现象。在项目的进行过程中，很多`page`中都有表格，每个`page`目录下都有自己的`.less`文件，*注意到由于表格格式高度类似，因此这些`.less`文件都是相同的（为后续埋下隐患）；* 由于新的表格与之前的很多表格样式接近但并不相同，因此我继续复制了其他组件一直使用的`.less`文件，并根据页面的需求进行调整，在这期间我遇到了奇怪的现象：

1.将样式中`margin-top`设为`0`后，对应部分`margin-top`没有改变；于是我使用了`!important`，修改成功，没有再深究；

2.到了另一个`page`，它的`margin-top`为`70px`，再次尝试使用`!important`，修改失败。使用`F12`开发者工具，选中对应元素可以看到它并没有外边距，查看样式，发现有很多完全同名的类选择器，其中就有第`1`点中提到的`page`的`.less`文件，这令我很诧异，因为每个`.less`文件都是在各自的`page`下的`index.jsx`文件引入，各自使用各自的`.less`样式，怎么会影响到其他`page`里去呢？而且有这么多的同名的类选择器，意味着样式文件没有隔离，而是混在一起。

这和我之前了解过的样式污染一样，但我还是第一次见，原理上是因为`CSS`没有本地作用域，所有声明的样式都是全局的（`global styles`）。换句话来说页面上任意元素只要匹配上某个选择器的规则，这个规则就会被应用上，而且规则和规则之间可以叠加作用（`cascading`）。`SPA`应用流行了之后这个问题变得更加突出了，因为对于`SPA`应用来说所有页面的样式代码都会加载到同一个环境中，样式冲突的概率会大大加大。这个项目正是`SPA`应用。

至于之前我自己从来没遇到过这种情况，原因主要是我几乎不重复使用`className`名，而且常用框架是`Vue`，`Vue`中关于样式使用了`scoped`属性，并且也正是由于学习了`scoped`属性，我在样式命名时更小心地避免使用重复的`className`名，因为哪怕是`scoped`属性也要求最外层的`className`不可重复。

分析了项目，前面也讲过，新的表格与之前的很多表格样式接近但并不相同，因此其实我只需要对这个新的`page`的样式文件进行处理即可，我将所有的`.itemxxx`统一更改为`.couponItemxxx`，避免了重名，也就消除了样式污染的问题。


  

